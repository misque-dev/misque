@import 'fumadocs-ui/style.css';
@import '@misque/ui/globals.css';

/* Override fumadocs sidebar background - set CSS variable */
:root {
  --sidebar-bg: transparent;
}

/* Force transparent background on sidebar using all possible selectors */
.bg-fd-card {
  --tw-bg-opacity: 0 !important;
}

aside.bg-fd-card,
[data-collapsed].bg-fd-card,
[data-fd-sidebar] .bg-fd-card {
  background-color: transparent !important;
  background: transparent !important;
}

/* Target any aside with data-collapsed attribute */
aside[data-collapsed] {
  background-color: oklch(0.98 0 0) !important;
  background: oklch(0.98 0 0) !important;
  border-right: 1px solid var(--border) !important;
}

.dark aside[data-collapsed] {
  background-color: oklch(0.1 0 0) !important;
  background: oklch(0.1 0 0) !important;
}

/* Make the Fumadocs sidebar fixed/sticky below navbar */
/* Target the sticky sidebar container and set proper top offset for navbar */
[grid-area='sidebar'],
.\[grid-area\:sidebar\] {
  position: fixed !important;
  top: 30px !important;
  left: 0 !important;
  height: calc(100vh - 20px) !important;
  z-index: 30 !important;
}

/* Ensure the aside inside takes full height */
[grid-area='sidebar'] > aside,
.\[grid-area\:sidebar\] > aside {
  height: 100% !important;
  position: relative !important;
  top: 0 !important;
}

/* Hide sidebar collapse trigger on desktop */
button[aria-label='Collapse Sidebar'],
button:has(> svg[data-lucide='panel-left-close']),
button:has(> svg[data-lucide='panel-left-open']) {
  display: none !important;
}

/* TOC popover - match navbar styling (bg-background/75 backdrop-blur-sm) */
[class*='grid-area:toc-popover'] {
  background: color-mix(
    in oklch,
    var(--background) 75%,
    transparent
  ) !important;
  backdrop-filter: blur(4px) !important;
  -webkit-backdrop-filter: blur(4px) !important;
  border-bottom: 1px solid var(--border) !important;
}

/* Docs pages - absolute white/black background based on theme */
:root {
  --background: #ffffff;
  --fd-background: #ffffff;
}

.dark {
  --background: #000000;
  --fd-background: #000000;
}

/* ==============================================
   Code Block Styling - Fumadocs UI Style
   ============================================== */

/* Base code block container (figure element) */
figure[data-rehype-pretty-code-figure] {
  margin: 1rem 0;
  border-radius: 0.5rem;
  border: 1px solid var(--border) !important;
  overflow: hidden;
  background: var(--fd-code-background, oklch(0.98 0 0));
}

.dark figure[data-rehype-pretty-code-figure] {
  background: var(--fd-code-background, oklch(0.1 0.01 0));
  border-color: var(--border) !important;
}

/* Dark mode code block borders - comprehensive selectors */
.dark [data-rehype-pretty-code-figure],
.dark figure:has(pre),
.dark div:has(> figure[data-rehype-pretty-code-figure]),
.dark article figure,
.dark .prose figure {
  border-color: var(--border) !important;
}

/* Title bar (figcaption) - shows filename */
figure[data-rehype-pretty-code-figure] > figcaption {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 1rem;
  font-size: 0.8125rem;
  font-weight: 500;
  color: var(--muted-foreground);
  background: var(--muted);
  border-bottom: 1px solid var(--muted);
}

.dark figure[data-rehype-pretty-code-figure] > figcaption {
  background: oklch(0.12 0.01 0);
  border-bottom-color: var(--muted);
}

/* File icon for title bar */
figure[data-rehype-pretty-code-figure] > figcaption::before {
  content: '';
  display: inline-block;
  width: 16px;
  height: 16px;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%2371717a' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z'/%3E%3Cpath d='M14 2v4a2 2 0 0 0 2 2h4'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: center;
  flex-shrink: 0;
}

/* Pre element styling */
figure[data-rehype-pretty-code-figure] pre {
  margin: 0;
  padding: 1rem;
  background: transparent !important;
  border: none;
  overflow-x: auto;
  font-size: 0.875rem;
  line-height: 1.7;
}

/* Code element */
figure[data-rehype-pretty-code-figure] pre > code {
  display: grid;
  counter-reset: line;
  font-family: var(
    --font-mono,
    ui-monospace,
    SFMono-Regular,
    'SF Mono',
    Menlo,
    Monaco,
    'Liberation Mono',
    'Courier New',
    monospace
  );
}

/* Code lines */
figure[data-rehype-pretty-code-figure] pre > code > [data-line] {
  padding: 0 0.5rem;
  border-left: 2px solid transparent;
}

/* Highlighted lines */
figure[data-rehype-pretty-code-figure] pre > code > [data-highlighted-line] {
  background: oklch(0.95 0.01 220);
  border-left-color: oklch(0.55 0.2 220);
}

.dark
  figure[data-rehype-pretty-code-figure]
  pre
  > code
  > [data-highlighted-line] {
  background: oklch(0.2 0.02 220);
  border-left-color: oklch(0.6 0.2 220);
}

/* Line numbers (optional) */
figure[data-rehype-pretty-code-figure]
  pre
  > code[data-line-numbers]
  > [data-line]::before {
  counter-increment: line;
  content: counter(line);
  display: inline-block;
  width: 1.5rem;
  margin-right: 1rem;
  text-align: right;
  color: var(--muted-foreground);
  opacity: 0.5;
}

/* ==============================================
   Terminal / Bash Code Block Styling
   ============================================== */

/* Terminal-style code blocks (bash, shell, terminal) */
figure[data-rehype-pretty-code-figure]:has(pre[data-language='bash']),
figure[data-rehype-pretty-code-figure]:has(pre[data-language='sh']),
figure[data-rehype-pretty-code-figure]:has(pre[data-language='shell']),
figure[data-rehype-pretty-code-figure]:has(pre[data-language='terminal']) {
  background: oklch(0.13 0.01 260) !important;
  border-color: oklch(0.22 0.01 260);
}

.dark figure[data-rehype-pretty-code-figure]:has(pre[data-language='bash']),
.dark figure[data-rehype-pretty-code-figure]:has(pre[data-language='sh']),
.dark figure[data-rehype-pretty-code-figure]:has(pre[data-language='shell']),
.dark
  figure[data-rehype-pretty-code-figure]:has(pre[data-language='terminal']) {
  background: oklch(0.1 0.01 260) !important;
  border-color: oklch(0.18 0.01 260);
}

/* Terminal title bar - darker with terminal icon */
figure[data-rehype-pretty-code-figure]:has(pre[data-language='bash'])
  > figcaption,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='sh'])
  > figcaption,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='shell'])
  > figcaption,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='terminal'])
  > figcaption {
  background: oklch(0.15 0.01 260);
  border-bottom-color: oklch(0.22 0.01 260);
  color: oklch(0.7 0.01 0);
}

/* Terminal icon */
figure[data-rehype-pretty-code-figure]:has(pre[data-language='bash'])
  > figcaption::before,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='sh'])
  > figcaption::before,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='shell'])
  > figcaption::before,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='terminal'])
  > figcaption::before {
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%23a1a1aa' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='4 17 10 11 4 5'/%3E%3Cline x1='12' x2='20' y1='19' y2='19'/%3E%3C/svg%3E");
}

/* Terminal code text color */
figure[data-rehype-pretty-code-figure]:has(pre[data-language='bash']) pre code,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='sh']) pre code,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='shell']) pre code,
figure[data-rehype-pretty-code-figure]:has(pre[data-language='terminal'])
  pre
  code {
  color: oklch(0.85 0.01 0);
}

/* Copy button styling */
figure[data-rehype-pretty-code-figure] button[data-copy] {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  padding: 0.375rem;
  border-radius: 0.375rem;
  background: transparent;
  border: none;
  color: var(--muted-foreground);
  cursor: pointer;
  opacity: 0;
  transition:
    opacity 0.2s,
    background-color 0.2s;
}

figure[data-rehype-pretty-code-figure]:hover button[data-copy] {
  opacity: 1;
}

figure[data-rehype-pretty-code-figure] button[data-copy]:hover {
  background: var(--muted);
}

/* Copy button in title bar */
figure[data-rehype-pretty-code-figure] > figcaption {
  position: relative;
}

/* ==============================================
   Inline Code Styling
   ============================================== */

:not(pre) > code {
  padding: 0.125rem 0.375rem;
  border-radius: 0.25rem;
  background: var(--muted);
  font-size: 0.875em;
  font-family: var(
    --font-mono,
    ui-monospace,
    SFMono-Regular,
    'SF Mono',
    Menlo,
    Monaco,
    'Liberation Mono',
    'Courier New',
    monospace
  );
  color: var(--foreground);
  border: 1px solid var(--border);
}

.dark :not(pre) > code {
  background: oklch(0.18 0.01 0);
  border-color: oklch(0.25 0.01 0);
}

/* ==============================================
   Table Styling - white/black based on theme
   ============================================== */

/* Table header - keep muted */
table thead,
table thead tr,
table thead th,
.prose table thead,
.prose table thead tr,
.prose table thead th {
  background-color: var(--border) !important;
}

/* Table body rows - white in light, black in dark */
table tbody,
table tbody tr,
table tbody td,
.prose table tbody,
.prose table tbody tr,
.prose table tbody td {
  background-color: #ffffff !important;
}

.dark table tbody,
.dark table tbody tr,
.dark table tbody td,
.dark .prose table tbody,
.dark .prose table tbody tr,
.dark .prose table tbody td {
  background-color: #000000 !important;
}

/* ==============================================
   Package Install Tabs Styling (npm/pnpm/yarn/bun)
   Only the code content area gets pure white/black
   ============================================== */

/* Target the code region/wrapper inside tabpanels */
[role='tabpanel'] [role='region'],
[role='tabpanel'] > div > div:last-child,
[role='tabpanel'] pre,
[role='tabpanel'] pre > code,
[role='tabpanel'] .bg-fd-secondary:not(:has([role='tablist'])) {
  background-color: #ffffff !important;
}

.dark [role='tabpanel'] [role='region'],
.dark [role='tabpanel'] > div > div:last-child,
.dark [role='tabpanel'] pre,
.dark [role='tabpanel'] pre > code,
.dark [role='tabpanel'] .bg-fd-secondary:not(:has([role='tablist'])) {
  background-color: #000000 !important;
}

/* ==============================================
   Fumadocs CodeBlock component overrides
   ============================================== */

/* Override any existing codeblock styling from fumadocs-ui */
[data-codeblock] {
  border-radius: 0.5rem;
  border: 1px solid var(--border);
  overflow: hidden;
  box-shadow: none !important;
}

/* Remove shadow from all code blocks and tabs */
figure[data-rehype-pretty-code-figure],
[role='tabpanel'] > div,
.prose pre,
pre,
[data-codeblock],
.fd-codeblock,
[class*='codeblock'],
article > div:has(pre),
article > div:has([data-codeblock]),
.prose > div:has(pre),
article div,
.prose div {
  box-shadow: none !important;
}

/* Nuclear option - remove all shadows in article content */
article *,
.prose * {
  --tw-shadow: 0 0 #0000 !important;
  --tw-shadow-colored: 0 0 #0000 !important;
  box-shadow: none !important;
}

/* Override Tailwind shadow classes in docs content */
article .shadow-sm,
article .shadow-md,
article .shadow-lg,
article .shadow-xl,
article .shadow-2xl,
.prose .shadow-sm,
.prose .shadow-md,
.prose .shadow-lg,
.prose .shadow-xl,
.prose .shadow-2xl {
  --tw-shadow: 0 0 #0000 !important;
  box-shadow: none !important;
}

[data-codeblock] > div:first-child {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.625rem 1rem;
  font-size: 0.8125rem;
  font-weight: 500;
  background: var(--muted);
  border-bottom: 1px solid var(--border);
}

.dark [data-codeblock] {
  background: oklch(0.1 0.01 0);
  border: 1px solid hsl(240 3.7% 25%) !important;
}

.dark [data-codeblock] > div:first-child {
  background: oklch(0.12 0.01 0);
  border-bottom-color: hsl(240 3.7% 25%) !important;
}

/* ==============================================
   Sidebar package items - remove chevrons and add icon styling
   ============================================== */

/* Hide chevrons (data-icon) from all sidebar items */
svg[data-icon],
[data-icon='true'],
aside svg[data-icon],
aside [data-icon='true'] {
  display: none !important;
  visibility: hidden !important;
  width: 0 !important;
  height: 0 !important;
  opacity: 0 !important;
}

/* Target ChevronDown icon in sidebar specifically using class */
aside svg.ms-auto,
aside .ms-auto svg {
  display: none !important;
}

/* Add icons to package links using CSS */
aside a[href*='/packages/'] {
  display: flex !important;
  align-items: center;
  gap: 0.5rem;
}

/* BookOpen icon for @misque/quran */
aside a[href*='/packages/quran']::before {
  content: '';
  display: inline-block;
  width: 1rem;
  height: 1rem;
  flex-shrink: 0;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z'%3E%3C/path%3E%3Cpath d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z'%3E%3C/path%3E%3C/svg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z'%3E%3C/path%3E%3Cpath d='M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z'%3E%3C/path%3E%3C/svg%3E");
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}

/* Clock icon for @misque/prayer-times */
aside a[href*='/packages/prayer-times']::before {
  content: '';
  display: inline-block;
  width: 1rem;
  height: 1rem;
  flex-shrink: 0;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolyline points='12 6 12 12 16 14'%3E%3C/polyline%3E%3C/svg%3E");
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}

/* Calendar icon for @misque/hijri */
aside a[href*='/packages/hijri']::before {
  content: '';
  display: inline-block;
  width: 1rem;
  height: 1rem;
  flex-shrink: 0;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='4' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Cline x1='16' y1='2' x2='16' y2='6'%3E%3C/line%3E%3Cline x1='8' y1='2' x2='8' y2='6'%3E%3C/line%3E%3Cline x1='3' y1='10' x2='21' y2='10'%3E%3C/line%3E%3C/svg%3E");
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}

/* Compass icon for @misque/qibla */
aside a[href*='/packages/qibla']::before {
  content: '';
  display: inline-block;
  width: 1rem;
  height: 1rem;
  flex-shrink: 0;
  background-color: currentColor;
  -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolygon points='16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76'%3E%3C/polygon%3E%3C/svg%3E");
  mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='12' cy='12' r='10'%3E%3C/circle%3E%3Cpolygon points='16.24 7.76 14.12 14.12 7.76 16.24 9.88 9.88 16.24 7.76'%3E%3C/polygon%3E%3C/svg%3E");
  -webkit-mask-size: contain;
  mask-size: contain;
  -webkit-mask-repeat: no-repeat;
  mask-repeat: no-repeat;
}
